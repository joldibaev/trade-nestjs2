# Миграции базы данных

## Основные команды

```bash
# Показать статус миграций
npm run migration:show

# Запустить все миграции
npm run migration:run

# Откатить последнюю миграцию
npm run migration:revert

# Сгенерировать новую миграцию
npm run migration:generate -- migrations/НазваниеМиграции

# Синхронизация схемы (только для разработки)
npm run schema:sync
```

## Сброс и заполнение данными

```bash
# Полный сброс БД + заполнение тестовыми данными
npm run db:reset

# Только заполнение тестовыми данными
npm run seed
```

## Правила работы с миграциями

### ❌ НЕ ДЕЛАЙТЕ
- Не пишите миграции вручную
- Не редактируйте существующие миграции после их применения
- Не используйте `schema:sync` в продакшне

### ✅ ДЕЛАЙТЕ
- Используйте `migration:generate` для создания миграций
- Проверяйте сгенерированные миграции перед применением
- Тестируйте миграции на копии данных

## Процесс создания миграции

1. Внесите изменения в entity файлы
2. Запустите: `npm run migration:generate -- migrations/ОписаниеИзменений`
3. Проверьте сгенерированный файл миграции
4. Примените: `npm run migration:run`

## Структура миграций

- Все миграции в папке `migrations/`
- Имя файла: `timestamp-Описание.ts`
- Дополнительные миграции только для изменений

## Отладка

```bash
# Посмотреть какие миграции применены
npm run migration:show

# Проверить логи миграций
docker-compose logs nestjs-app | grep migration
```


